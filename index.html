<!DOCTYPE html> 
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
	<title>Bubble Island Fork</title>

    <meta name="viewport" content="user-scalable=0, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
	
	<script src="http://connect.facebook.net/en_US/all.js"></script>
	<script src="jquery.js" type="text/javascript" charset="utf-8"></script> 
	<script src="phonegap.js" type="text/javascript" charset="utf-8"></script> 
	<script src="jqueryMobile.js" type="text/javascript" charset="utf-8"></script> 
	 <!-- game -->
	<script src="side.js" type="text/javascript" charset="utf-8"></script> 
	<script src="bubbleIsland.js" type="text/javascript" charset="utf-8"></script> 	
	<script type="text/javascript" charset="utf-8">
		//redirect_url = "http://www.facebook.com/connect/login_success.html";
		document.addEventListener('deviceready', function(){
				alert('now we will make facebook conn');
				
				FB.init({
					appId  : APPID,
					status : true, // check login status
					cookie : true, // enable cookies to allow the server to access the session
					xfbml  : true  // parse XFBML
				});
				
				session  =FB.getSession()
				if(session == null){
					alert('no hay session');
					var authorize_url  = "https://graph.facebook.com/oauth/authorize";
					var authorize_data = {
						client_id : APPID,
						redirect_uri : redirect_url,
						display : 'touch',
						type : "user_agent"
					};
						
					alert('before ajax');
					/*var authorize_url  = "https://graph.facebook.com/oauth/authorize?";
					authorize_url += "client_id=" + APPID;
					authorize_url += "&redirect_uri=" + redirect_url;
					authorize_url += "&display=touch"
					authorize_url += "&type=user_agent";
					var browserDiv = document.createElement('iframe');
					browserDiv.style.position = 'absolute';
					browserDiv.style.top = '0px';
					browserDiv.style.left = '0px';
					browserDiv.style.width = '320px';
					browserDiv.style.hegiht = '480px'
					//browserDiv.innerHTML = data;				
					document.body.appendChild(browserDiv);
					browserDiv.src = authorize_url;
					$('form').submit( function(){alert('you are so fucking close');} );*/
					$.ajax({
						url: authorize_url,
						data: authorize_data,
						success: function(data){ 
							var browserDiv = document.createElement('nav');
							browserDiv.style.position = 'absolute';
							browserDiv.style.top = '0px';
							browserDiv.style.left = '0px';
							browserDiv.style.width = '320px';
							browserDiv.style.hegiht = '480px'
							browserDiv.innerHTML = data;
							document.body.appendChild(browserDiv);
							$('form').submit( function(){alert('you are so fucking close');} );
						},
						error: function(a,b, c){ 
							alert('error!  ' + b + c);
							for(i in a){ alert(i + ' : ' + a[i]); }
						}
					});
				}else{
					for(i in session){
						alert(i + ' : ' + session[i]);
					};
				};
			
		//});
		}, false);
	</script> 
	<style type="text/css">
		* {
			margin: 0;
			padding: 0;
		}
	
		body, html { 
			width: 320px;
			height: 480px;
			overflow: hidden;
			margin: 0;
			padding: 0;
		}
		
		img{
			image-rendering: optimizeSpeed;
			-webkit-interpolation-mode: nearest-neighbor;
		}

	</style>
</head>
<body>
<nav style="width: 320px; min-height: 480px; background-image: url('background.png'); position: absolute; top: 0px; left: 0px" ontouchmove="touchMove(event);">

<nav id="frameBackground" style="width: 320px; min-height: 480px; background-image: url('lvlboundering.png'); position: absolute; top: 0px; left: 0px;">
</nav>
 <!--background-image: url('background.png')-->
<!--canvas id="gameBackgroundCanvas" style="position: absolute; top: 0px; left: 0px"></canvas-->
<canvas id="gameCanvas" style="position: absolute; top: 0px; left: 0px; display:none" ></canvas>
<nav id="animCanvas" style="position: absolute; top: 0px; left: 0px; "></nav>
<nav id="optionMenu" style="position: absolute; top: 0px; left: 0px; width: 100%; min-height: 100%; display: none" >
<div style="position: absolute; display: table; top: 20%; bottom: auto; margin: auto; width: 100%">
	<span style="font: bold 20px verdana, sans-serif; text-align: center">Bubble Paradise</span><br>
	<div style="margin-top: 20px">
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onClick="alert('why? i dont have any sound yet!')">Sounds Enable (touch for disable it)</nav>
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onCLick="alert('when you make some real points, you will want to post it')">Post my Highscore on Facebook!</nav>
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onClick="alert('oh, rly?')">Get more coins!</nav>
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onClick="options.exitOptions()">get back to Main Menu</nav>
	</div>
	</div>
</nav>
<nav id="gameMenu" style="width: 100%; min-height: 100%; position: absolute; top: 0px; left: 0px; text-align: center; background-image: url('background.png');">
	<div style="position: absolute; display: table; top: 20%; bottom: auto; margin: auto; width: 100%">
	<span style="font: bold 20px verdana, sans-serif; text-align: center">Bubble Paradise</span><br>
	<div style="margin-top: 20px">
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onClick="game.startNewGame()">New Game</nav>
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onClick="alert('what game??')">Continue Game</nav>
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onCLick="options.showOptions('gameMenu')">Options</nav>
	<nav style="font: bold 15px verdana, sans-serif; margin-top: 10px" onClick="ww = window.open(window.location, '_self'); ww.close();">Leave Paradise :(</nav>
	</div>
	</div>
</nav>
<nav id = "initScreen" style="position: absolute; top: 0px; left: 0px; border: 1px solid black; width: 100%; min-height: 100%; background-color: #fff	">
<img id="logoImg" src="logo.jpg" alt="logo" style="display: none; display: none; margin-left:auto; margin-right:auto; "/>
<div id = "loadingScreen" style="position: absolute; top: 50%; bottom: auto; width: 100%; height: 50%; background-color: #fff">
	<div style="font: 2em Verdana, sans-serif; text-align: center; width: 100%">Loading... </div><br>
	<div style="width: 80%; min-height: 30px; border: 1px solid black; margin: 0 auto">
		<div id="progress" style="width: 50%; height: 30px; border: 1px solid black; background-color: #333333">
		</div>
	</div>
</div>
</nav>

</nav> <!-- nav background-->
<div id="fb-root"></div>
<script type="text/javascript" charset="utf-8">
/*FB.init({
	appId  : APPID,
	appKey : APPKEY,
	status : true, // check login status
	cookie : true,//, // enable cookies to allow the server to access the session
	xfbml  : true  // parse XFBML
});*/
/*function onBodyLoad()
{
	document.addEventListener("deviceready",onDeviceReady,false);		
}*/
redirect_url = "http://localhost";

/*FB.init({
	appId  : APPID,
	status : true, // check login status
	cookie : true, // enable cookies to allow the server to access the session
	xfbml  : true  // parse XFBML
});*/

//window.open("https://www.facebook.com/dialog/oauth?client_id=" + APPID + "&redirect_uri="+redirect_url+"&scope=email,publish_stream");
	  
$(window).load(function () {	

});

				
loader = new Loader('progress');
loader.readyLoad = function(){	
	//toda la intro del juego
	
	$('#loadingScreen').fadeOut('fast', function(){
		$('#logoImg').fadeIn(1900, function(){
			$(this).fadeOut(1900, function(){
				$("#initScreen").remove();		
				//game = new appEnviroment("gameCanvas", "gameMenu", "gameBackgroundCanvas", "320x480");
				//alert(screen.width);
				if(screen.width >= 854) gameSize = "854x480";
				if(screen.width <= 640) gameSize = "640x960";
				if(screen.width <= 480) gameSize = "480x800";
				if(screen.width <= 360) gameSize = "360x480";
				if(screen.width <= 320) gameSize = "320x480";
				options = new Options('optionMenu');
				game = new appEnviroment("gameCanvas", "gameMenu", "animCanvas", gameSize);
				//FB.login(function(){ alert('login'); });
				//clock.connect(game.startAnimation, 'tick')
				//clock.start();				
				
			});
		});
		//$('#logoImg').fadeIn();
	});
};


loader.init();

// fps
/*var s = document.createElement('script');
s.src = 'https://github.com/mrdoob/stats.js/raw/master/build/Stats.js';
document.body.appendChild(s);
s.onload = function() {

    var stats = new Stats(),
        ss = stats.domElement.style;
    ss.position = 'fixed';
    ss.left = '0px';
    ss.top = '0px';
    document.body.appendChild(stats.domElement);
    setInterval(stats.update, 1000 / 60);
}
*/

</script> 
</body>
</html>