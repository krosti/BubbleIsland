<!DOCTYPE html> 
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
	<title>Bubble Paradise</title>

    <meta name="viewport" content="user-scalable=0, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style"content="black-translucent" /> 
	<meta name="apple-touch-fullscreen" content="yes" /> 

    <link href="css/320x480.css" rel="stylesheet" type="text/css" />
	<link href="css/360x480.css" rel="stylesheet" type="text/css" />
	<link href="css/480x800.css" rel="stylesheet" type="text/css" />
	<link href="css/640x960.css" rel="stylesheet" type="text/css" />
	<link href="css/854x480.css" rel="stylesheet" type="text/css" />

<script src="phonegap.js" type="text/javascript" charset="utf-8"></script> 
	<!--script src="jquery.js" type="text/javascript" charset="utf-8"></script> 
	<script src="jquerycookie.js" type="text/javascript" charset="utf-8"></script> 
	<script src="jquerymd5.js" type="text/javascript" charset="utf-8"></script> 
	<script src="api.js" type="text/javascript" charset="utf-8"></script> 
	<script src="apileaderboard.js" type="text/javascript" charset="utf-8"></script>
	<script src="apisoftgames.js" type="text/javascript" charset="utf-8"></script>
	<script src="jqueryMobile.js" type="text/javascript" charset="utf-8"></script>
	<script src="soundapi.js" type="text/javascript" charset="utf-8"></script>

	 game
	 <script src="jqueryMobile.js" type="text/javascript" charset="utf-8"></script> 
	<script src="playtomic.js" type="text/javascript" charset="utf-8"></script>
	 <script src="phonegap.js" type="text/javascript" charset="utf-8"></script> 
	<script src="FB.js" type="text/javascript" charset="utf-8"></script> 
	<script src="coinsApi.js" type="text/javascript" charset="utf-8"></script> 		 

	<script src="leaderboard.js" type="text/javascript" charset="utf-8"></script> 
	<script src="side.js" type="text/javascript" charset="utf-8"></script> 
	<script src="bubbleIsland.js" type="text/javascript" charset="utf-8"></script>
	  	 -->
	<script src="gamemin.js" type="text/javascript" charset="utf-8"></script>

	<script type="text/javascript" charset="utf-8">
		//redirect_url = "http://www.facebook.com/connect/login_success.html";
		document.addEventListener('deviceready', function(){			
			loader.init();
			/*var media = new Media('sounds/music/backgroundmusic.mp3');
			media.play();*/
		}, false);
	</script> 
	
	<link rel="stylesheet" type="text/css" href="css/facebook.css">
	
	
	<style type="text/css">
		* {
			margin: 0;
			padding: 0;
			background-repeat: no-repeat;
		}
	
		body, html { 
			width: 320px;
			height: 480px;
			overflow: hidden;
			margin: 0;
			padding: 0;
		}
		
		img{
			image-rendering: optimizeSpeed;
			-webkit-interpolation-mode: nearest-neighbor;
		}
		.bubble{
			background-repeat: no-repeat;
		}
		#leaderboardTabs { padding: 0; margin-top: 50px; }
		#leaderboardTabs li { display: inline; }
		#leaderboardTabs li a { background: #ccf; padding: 10px; float:left; border-right: 1px solid #ccf; border-bottom: none; text-decoration: none; color: #000; font-weight: bold;}
		#leaderboardTabs li.active a { background: #eef; }
		.content { float: left; clear: both; border: 1px solid #ccf; border-top: none; border-left: none; background: #eef; padding: 10px 20px 20px; width: 400px; }
		/*facebook*/

	</style>
</head>
<body>
<nav id="backgroundNav" style="position: absolute; top: 0px; left: 0px;" ontouchmove="touchMove(event);">

<nav id="frameBackground" style="width: 100%; height: 300px; background-position: bottom center; position: absolute; top: 0px; left: 0px; display: none">
</nav>
 <!--background-image: url('background.png')-->
<!--canvas id="gameBackgroundCanvas" style="position: absolute; top: 0px; left: 0px"></canvas-->
<canvas id="gameCanvas" style="position: absolute; top: 0px; left: 0px; display:none" ></canvas>
<nav id="animCanvas" style="position: absolute; top: 0px; left: 0px; ">
	<!--div onClick="game.showMenu()" style="postion: absolute; top: 10px; left: 100px; right: auto">Back To Menu</div-->
</nav>
<nav id="resolutionNav" style="background-position: center center; display: none; width: 100%; max-height: %100"></nav>
<!--nav id="softgameNav" style="position: absolute; top: 0px; left: 0px; width: 100%; min-height: 100%; display: none;">
	Api de pagos <br />
	Cargando estado de cuenta <br />
	<div onClick="options.backToMenu()">Back</div>
</nav-->
<nav id="leaderboardMenu" style="position: absolute; top: 0px; left: 0px; width: 100%; min-height: 100%; display: none; ">
	<!--ul id="leaderboardTabs">
		<li><a href="#generalLeaderboard"><div id="generalLeaderboardTab"></div></a></li>
		<li><a href="#facebookLeaderboard"><div id="facebookLeaderboardTab"></div></a></li>
	</ul-->
	<div id="generalLeaderboardTab" onClick="$('#generalLeaderboard')[0].style.display = 'block'; $('#facebookLeaderboard')[0].style.display = 'none';/*soundengine.reproduceSound('optionin');*/"></div>
	<div id="facebookLeaderboardTab" onClick="$('#generalLeaderboard')[0].style.display = 'none'; $('#facebookLeaderboard')[0].style.display = 'block'; /*soundengine.reproduceSound('optionin');*/"></div>
	<div id="generalLeaderboard"></div>
	<div id="facebookLeaderboard" style="display: none"></div>

	<div id="leaderboardBackMenu" onClick="options.exitLeaderboard(); $('#optionMenu')[0].style.display = 'none'; $('#gameMenu')[0].style.display = 'block';/*soundengine.reproduceSound('optionin');*/"></div>
</nav>
<nav id="optionMenu" style="position: absolute; top: 0px; left: 0px; width: 100%; min-height: 100%; display: none;" >
	<div id="optionsVolumeOn" onClick="/*soundengine.reproduceSound('optionin');soundengine.enableSound();*/"></div>
	<div id="optionsVolumeOff" onClick="/*soundengine.reproduceSound('optionin');soundengine.disableSound();*/"></div>

	<!--div id="facebookLogoutButton" onClick="/*api.facebook.logout(setInitState);*/FB.logout(setInitState);"></div-->
	<div id="optionsMenuButton" onClick="$('#gameMenu')[0].style.display = 'block'; $('#optionMenu')[0].style.display = 'none';options.exitOptions();/*soundengine.reproduceSound('optionin');*/"></div>
	<div id="optionsFacebook" onClick="postOnFacebook();/*soundengine.reproduceSound('optionin');*/ //inviteFriends();"></div>
	<div id="optionsCoins" onClick="showCoins();/*soundengine.reproduceSound('optionin');*/"></div>
	<div id="optionsLeaderboards" onClick="options.showLeaderboard('optionMenu'); retrieveLeaderboard('facebookLeaderboard', 'generalLeaderboard');/*soundengine.reproduceSound('optionin');*/"></div>
</nav>

<nav id="gameMenu" style="width: 100%; min-height: 100%; position: absolute; top: 0px; left: 0px; text-align: center; ">
	<div style="position: absolute; display: table; top: 20%; bottom: auto; margin: auto; width: 100%">	
		<div id="newbutton" onClick="game.startNewGame();/*soundengine.reproduceSound('optionin');*/"></div>
		<div id="continuebutton" onClick="game.continueGame();/*soundengine.reproduceSound('optionin');*/" ></div>
		<div id="optionbutton" onClick="options.showOptions('gameMenu');/*soundengine.reproduceSound('optionin');*/" ></div>

		<div id="facebookFrame" onClick=" postOnFacebook(); api.ui.alert('Thanks for sharing!', 'Ok!');"></div>
		<!--div id="coinsFrame" onClick="showCoins();"></div-->
		<div id="addFriends" onClick="inviteFriends();"></div>
		<div id="leaderboardFrame" onClick="options.showLeaderboard('gameMenu'); retrieveLeaderboard('facebookLeaderboard', 'generalLeaderboard');"></div>
	</div>
</nav>
<nav id = "FBnav" style="width: 100%; min-height: 100%; position: absolute; top: 0px; left: 0px; background-color: #fff">
	<!--div id="FBbutton" onClick="api.facebook.framework.style.display = 'block';/*connectToFacebook()*/"></div-->
	<div id="FBbutton" onClick="connectToFacebook()"></div>
</nav>
<nav id = "initScreen" style="position: absolute; top: 0px; left: 0px; border: 1px solid black; width: 100%; min-height: 100%; background-color: #fff	">
<div id="progressBar">
	<div id="progress" style="width: 0%; height: 100%; background-color: #ffffff">
	</div>
</div>
<img id="softgamesLogoImg" src="logo.jpg" alt="logo" style="position: absolute; display: none; margin-left:auto; margin-right:auto; "/>	
<img id="logoImg" src="logo.jpg" alt="logo" style="position: absolute; display: none; margin-left:auto; margin-right:auto; "/>	

<!--div id = "loadingScreen" style="position: absolute; top: 0px; left: 0px; width: 100%; min-height: 100%; background-color: #fff">
</div-->
</nav>
<nav id="SGnav" style="display: none; width: 100%; height: 100%; position:absolute; min-height: 100%; background-color: #ffffff"></nav>
</nav> <!-- nav background

<nav id = "FBnav" style="width: 100%; min-height: 100%; position: absolute; top: 0px; left: 0px; background-color: #fff">
	This Application needs your Facebook account information to link you with your friends <br />
	Please, log on with your account and allow this application to use your profile information and post in your wall <br />
	Thank you! and enjoy your stay in our Paradise!!
</nav>
<div id="debug" style="margin-top: 490px"></div>
-->

<script type="text/javascript" charset="utf-8">
var firstRun = false;
//setDebugEnv('debug');
//setDebugEnv('initScreen');	  
/*softgame = new softgameApi();
	softgame.startConnection();*/
function $_GET(q) { 
    var s = window.location + ''; 
    q = q + '=';
    if(s.indexOf(q) != -1){ //existe token			
		return decodeURI(s.slice(s.indexOf(q) + q.length, s.indexOf("&")));
	}else{
		return '';
	};
} 

function inviteFriends(){
	window.location = 'http://www.facebook.com/dialog/apprequests?app_id=' + api.facebook.appid + '&message=BubbleParadise&redirect_uri=http://puzzlebubble.eudaimonia.com.ar/success/index.html';
	//$.mobile.loadPage('http://www.facebook.com/dialog/apprequests?app_id=' + api.facebook.appid + '&message=testing&redirect_uri=http://www.facebook.com/connect/login_success.html');
}

function connectToFacebook2(){
		//window.location = 'https://www.facebook.com/dialog/oauth?client_id=' + APPID + '&scope=publish_stream&redirect_uri='+window.location+'&response_type=token';
		//softgame.onLoad = connectToFacebook2;
		
		//softgame.onLoginUser = connectToFacebook2;
		//softgame.startConnection();
		//alert('connectToFacebook2');
		//api.softgame.onLoginUser = function(){			
		//};
		//alert(document.cookie);
		/*api.softgame.onLogin = function(){
			
		};*/
		//soundengine.starttheme();

		api.facebook.loaded = function(){	
			api.ui.hideWaiting();		
			if(firstRun) api.facebook.postMessage(api.facebook.user.name + ' is now playing Bubble Paradise, join ' + (api.facebook.user.gender == 'male' ? 'him' : 'her') + ' on this link @' + api.facebook.appname + '!');
		};

		api.softgame.startConnection();
		
		api.facebook.retrieveUserData();

		//api.ui.hideWaiting();
		$('#FBnav')[0].style.display = 'none';
		//soundengine.startThemes(['background', 'maintheme']);
};

function needLogin(){
	document.getElementById('FBnav').onclick = function() { api.facebook.framework.style.display = 'block'; };
};

function connectToFacebook(){
	$('#FBbutton').click(function(){});
	api.ui.showWaiting();
	api.facebook.framework = document.getElementById('SGnav');
	api.softgame.framework = document.getElementById('SGnav');
	api.facebook.onConnect = connectToFacebook2;
	api.facebook.onNeedLogin = needLogin;
	api.facebook.startConnection();
	
	/*alert('before ajax: ' + FB.url);
	FB.onConnect = connectToFacebook2;
	jq = $.ajax({
		type: 'GET',
		url: FB.url,
		success: function(data){ FB.connectResponse(data) },
		error: function(data, error){FB.error(data, error) }
	})*/
};

$(window).load(function () {	
//SWFID: 2647
//GUID: 3689729b4f17433c
	setTimeout(function(){ window.scrollTo(0,1); }, 0);
	//ºloader.init();
	if(window.localStorage.getItem('runned') == null){
		firstRun = true;
		window.localStorage.setItem('runned', 1);
	};

	if(window.localStorage.getItem('enablesound') == null){
		window.localStorage.setItem('enablesound', 1);
		soundengine.enable = true;
		document.getElementById("optionsVolumeOn").style.display = 'none';
	}else{
		if(window.localStorage.getItem('enablesound') == 1){
			soundengine.enable = true;
			document.getElementById("optionsVolumeOn").style.display = 'none';
		}else{
			soundengine.enable = false;			
			document.getElementById("optionsVolumeOff").style.display = 'none';
		};
	};
});
var gameSize = "320x480";
var leaderboardElided = 18;
if((screen.width == "854" && screen.height == "480") || (screen.width == "854" && screen.height == "480")){
	gameSize = "854x480";
}else{
	if(screen.width <= 640) gameSize = "640x960";
	if(screen.width <= 480) gameSize = "480x800";
	if(screen.width <= 360) gameSize = "360x480";
	if(screen.width <= 320) gameSize = "320x480";
};
//if(screen.width >= 854) gameSize = "854x480";
//gameSize = "320x480";
/*if(screen.width <= 640) gameSize = "640x960";
if(screen.width <= 320) gameSize = "320x480";*/
//var gameSize = "320x480";
if(gameSize == "854x480") linesPerLevel = 3;

var loader = new Loader('progress', gameSize);
var options = new Options('optionMenu', 'leaderboardMenu');
//$('#leaderboardTabs ul').idTabs();
$('#initScreen').addClass('initScreen'+gameSize);
$('#backgroundNav')[0].style.width = gameSize.slice(0,3) + 'px';
$('#backgroundNav')[0].style.height = gameSize.slice(4) + 'px';
//$('#frameBackground')[0].style.backgroundImage = 'url('++')';
$('#frameBackground')[0].style.width = gameSize.slice(0,3) + 'px';
$('#frameBackground')[0].style.height = gameSize.slice(4) + 'px';
$('#FBnav')[0].style.width = gameSize.slice(0,3) + 'px';
$('#FBnav')[0].style.height = gameSize.slice(4) + 'px';

$('#progressBar').addClass('loadingProgressBar' + gameSize);

$("#generalLeaderboard").addClass('leaderboardTab' + gameSize);
$("#facebookLeaderboard").addClass('leaderboardTab' + gameSize);
$("#generalLeaderboardTab").addClass('leaderboardTabHighscore' + gameSize);
$("#facebookLeaderboardTab").addClass('leaderboardTabFriends' + gameSize);
$("#leaderboardBackMenu").addClass('leaderboardBackMenu' + gameSize);
$("#leaderboardTabs").addClass('leaderboardTabs' + gameSize);
//document.getElementById('logoImg').src = gameSize + '/logo.jpg';
document.getElementById('softgamesLogoImg').src = gameSize + '/softgame.png';
function showCoins(){
	api.ui.showWaiting();
	api.softgame.onLoginUser = function(){
		api.ui.hideWaiting();		
		api.ui.showBalance();
	};
	//options.showNav('softgameNav', 'gameMenu');
	api.softgame.getUserInfo();
};

function setInitState(response){
	api.facebook.accessToken = '';
	//document.cookie = "";
	/*var cookies = document.cookie.split(";");

    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }*/
    /*var cookies = $.cookie();
    for(var i = 0; i < cookies.length; ++i){
    	alert(cookies[i].name + ' : ' + cookies[i].value);
    };
    alert(document.cookie);*/
    $.cookie('.m_user', null);
    $.cookie('m_user', null);
    $.cookie('e', null);
    $.cookie('L', null);
    $.cookie('W', null);
    
	$('#gameMenu')[0].style.display = 'block'; $('#optionMenu')[0].style.display = 'none'; options.exitOptions();
	document.getElementById('FBnav').style.display = 'block';
	connectToFacebook();
};

function postOnFacebook(){
	var msg = api.facebook.user.name + ' is playing Bubble Paradise! Come on and enjoy it with ' + (api.facebook.user.gender == 'male' ? 'him' : 'her') + ' on this link @' + api.facebook.appname + '!';
	api.facebook.postMessage(msg);
};

loader.readyLoad = function(){	
	//toda la intro del juego
	//alert('hola');
	//alert('url('+backgroundImage.src+')');
	//alert(gameSize.slice(0,3) + 'x' + gameSize.slice(4));
	$('#leaderboardMenu')[0].style.backgroundImage = 'url('+initImage.src+')';
	$('#optionMenu')[0].style.backgroundImage = 'url('+initImage.src+')';
	$('#gameMenu')[0].style.backgroundImage = 'url('+initImage.src+')';
	$('#frameBackground')[0].style.backgroundImage = 'url('+lvlFrame.src+')';
	document.getElementById('backgroundNav').style.backgroundImage = 'url('+backgroundImage.src+')';

	$('#newbutton')[0].src = uiNewButton.src;
	$('#continuebutton')[0].src = uiContinueButton.src;
	$('#optionbutton')[0].src = uiOptionButton.src;
	//$('#facebookLogoutButton').addClass('optionsLogout' + gameSize);

	$('#facebookFrame').addClass('facebookFrame' + gameSize);
	//$('#coinsFrame').addClass('coinsFrame' + gameSize);
	$('#addFriends').addClass('addFriends' + gameSize);
	$('#leaderboardFrame').addClass('leaderboardFrame' + gameSize);

	$('#newbutton').addClass('playImage' + gameSize);
	$('#continuebutton').addClass('continueImage' + gameSize);
	$('#optionbutton').addClass('optionsImage' + gameSize);

	$('#leaderboardMenu')[0].style.backgroundImage = 'url('+uiLeaderboardScreen.src+')';

	$('#optionMenu')[0].style.backgroundImage = 'url(' + uiOptionsBackground.src + ')';
	$('#optionsMenuButton').addClass('optionsMenu' + gameSize);
	$('#optionsFacebook').addClass('optionsFacebook' + gameSize);
	$('#optionsCoins').addClass('optionsCoins' + gameSize);
	$('#optionsLeaderboards').addClass('optionsLeaderboards' + gameSize);
	$('#optionsVolumeOn').addClass('optionsVolumeOn' + gameSize);
	$('#optionsVolumeOff').addClass('optionsVolumeOff' + gameSize);
	
	$('#FBnav')[0].style.backgroundImage = 'url('+facebookScreen.src+')';
	$('#FBbutton').addClass('facebookButton'+gameSize)
	//$('#initScreen').fadeOut(600, function(){ $(this).remove(); });
	//$('#loadingScreen').fadeOut('fast', function(){
	//FB.token = $_GET('access_token');
	//if(FB.token != ''){	
		game = new appEnviroment("gameCanvas", "gameMenu", "animCanvas", gameSize);	
		//FB.element.style.display = 'none';
		//FB.retrieveUserData();
		//FB.retrieveFriendsData();
	//};

	/*$('#softgamesLogoImg').show(1000, function(){
		$(this).delay(3000, function(){
			$('#logoImg').show(1000, function(){
				$(this).delay(3000, function(){
					$("#initScreen").remove();
					connectToFacebook();
				});
			});
		});
	});*/
	/*soundengine.setuptheme('sounds/music/maintheme.mp3', 9500);
	soundengine.setupbackground('sounds/music/backgroundmusic.mp3', 64500);*/
	/*soundengine.setuptheme('/android_asset/www/sounds/music/maintheme.mp3', 9500);
	soundengine.setupbackground('/android_asset/www/sounds/music/backgroundmusic.mp3', 64500);*/
	$('#softgamesLogoImg').show(1000, function(){
		soundengine.startbackground();
		$('#softgamesLogoImg').delay(20000, function(){
			//$('#softgamesLogoImg').hide();
			/*$('#logoImg').show(1000, function(){
				$('#logoImg').delay(10000, function(){*/
					//$("#initScreen").remove();
					//$("#initScreen").delay(2000, function(){
						document.getElementById('backgroundNav').style.backgroundImage = 'url('+backgroundImage.src+')';
						$('#frameBackground')[0].style.display = 'block';
						connectToFacebook();
						var p = $("#initScreen").remove();
						delete p;
							/*});
							//alert('hola');
						});*/
					//});
		});
	});
	/*soundengine.setuptheme('/android_asset/www/sounds/music/maintheme.mp3', 9500);
	soundengine.setupbackground('/android_asset/www/sounds/music/backgroundmusic.mp3', 64500);
	$('#softgamesLogoImg').show(1000, function(){
		soundengine.startbackground();
		$('#softgamesLogoImg').delay(20000, function(){
			document.getElementById('backgroundNav').style.backgroundImage = 'url('+backgroundImage.src+')';
			$('#frameBackground')[0].style.display = 'block';
			connectToFacebook();
			var p = $("#initScreen").remove();
			delete p;
		});
	});*/

	//$('#softgamesLogoImg').show(1000);
	/*document.getElementById('softgamesLogoImg').style.display = 'block';
	setTimeout(function(){
		//document.getElementById('backgroundNav').style.backgroundImage = 'url('+backgroundImage.src+')';
		//document.getElementById('FBnav').style.display = 'block';
		$('#frameBackground')[0].style.display = 'block';
		setTimeout(function(){
			$("#initScreen").remove();
			//delete p;
			connectToFacebook();
		},1000);
	}, 6000);*/
	//});
	//soundengine.startTheme('background');
	
		//soundengine.reproduceSound('background');
};

/*soundengine.soundToggled = function(){
	if(soundengine.enable){
		document.getElementById('optionsVolumeOn').style.display = "none";
		document.getElementById('optionsVolumeOff').style.display = "block";
	}else{
		document.getElementById('optionsVolumeOff').style.display = "none";
		document.getElementById('optionsVolumeOn').style.display = "block";
	};
};*/
</script> 
</body>
</html>